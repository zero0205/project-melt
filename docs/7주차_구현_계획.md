# 7ì£¼ì°¨: REST API í™•ì¥

**ğŸ¯ êµ¬í˜„ ëª©í‘œ:**

- **RESTful API ì–´ë…¸í…Œì´ì…˜ í™•ì¥** (@RestController, @GetMapping, @PostMapping, @PutMapping, @DeleteMapping, @PatchMapping)

**ğŸ“‹ í˜„ì¬ ìƒí™©:**

- âœ… ê¸°ë³¸ MVC êµ¬ì¡° ì™„ì„± (@Controller, @RequestMapping)
- âœ… íŒŒë¼ë¯¸í„° ë°”ì¸ë”© (@RequestParam, @PathVariable, @RequestBody)
- âœ… HTTP ë©”ì†Œë“œë³„ ì²˜ë¦¬ (GET, POST, PUT, DELETE)
- âœ… JSON ì‘ë‹µ ì²˜ë¦¬

---

## ğŸ“š ê°œë… í•™ìŠµ (ê°œë³„ ì§„í–‰)

### **AOP í•µì‹¬ ê°œë… (ê°œë³„ í•™ìŠµ):**

- **AOP (Aspect-Oriented Programming)**: íš¡ë‹¨ ê´€ì‹¬ì‚¬(ë¡œê¹…, ë³´ì•ˆ, íŠ¸ëœì­ì…˜)ë¥¼ ë¶„ë¦¬í•˜ëŠ” í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„
- **Dynamic Proxy & InvocationHandler** - AOP êµ¬í˜„ì˜ í•µì‹¬ â­â­â­
- **Proxy Pattern** - AOPì˜ ê¸°ë°˜ ë””ìì¸ íŒ¨í„´
- **Cross-cutting Concerns**: ì—¬ëŸ¬ ëª¨ë“ˆì— ê±¸ì³ ë‚˜íƒ€ë‚˜ëŠ” ê³µí†µ ê¸°ëŠ¥ë“¤

### **êµ¬í˜„ ì¤‘ì‹¬ í•™ìŠµ:**

- **REST API ì›ì¹™** - HTTP ë©”ì†Œë“œ í™œìš©
- **RESTful ì–´ë…¸í…Œì´ì…˜** (@RestController, @GetMapping ë“±)
- **JSON ì‘ë‹µ ì²˜ë¦¬**

---

## ğŸ§  í•µì‹¬ ê°œë… ì´í•´

- **REST API**: Representational State Transfer, HTTPë¥¼ ì˜ í™œìš©í•œ API ì„¤ê³„ ì›ì¹™
- **@RestController**: JSON ì‘ë‹µì„ ê¸°ë³¸ìœ¼ë¡œ í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬
- **HTTP Method Mapping**: ê° HTTP ë©”ì†Œë“œë³„ ì „ìš© ì–´ë…¸í…Œì´ì…˜ (@GetMapping, @PostMapping ë“±)

---

## ğŸ’» êµ¬í˜„ ë‚´ìš©

### **1. REST API ì–´ë…¸í…Œì´ì…˜ í™•ì¥**

```java
// 1) @RestController ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface RestController {}

// 2) HTTP ë©”ì†Œë“œë³„ ë‹¨ì¶• ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface GetMapping {
    String value();
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface PostMapping {
    String value();
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface PutMapping {
    String value();
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DeleteMapping {
    String value();
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface PatchMapping {
    String value();
}

// 3) ê¸°ì¡´ UserControllerë¥¼ REST API ìŠ¤íƒ€ì¼ë¡œ í™•ì¥
@RestController  // ìƒˆë¡œìš´ REST ì»¨íŠ¸ë¡¤ëŸ¬
public class ApiController {

    @Autowired
    private UserService userService;

    @GetMapping("/api/users")  // ê¸°ì¡´ @RequestMapping ëŒ€ì‹  ë‹¨ì¶•í˜•
    public String getUsers() {
        return "{\"users\": \"API response\"}";
    }

    @PostMapping("/api/users")
    public String createUser(@RequestBody String user) {
        return "{\"message\": \"User created: " + user + "\"}";
    }

    @PutMapping("/api/users/{id}")
    public String updateUser(@PathVariable("id") Long id, @RequestBody String user) {
        return "{\"message\": \"User " + id + " updated: " + user + "\"}";
    }

    @DeleteMapping("/api/users/{id}")
    public String deleteUser(@PathVariable("id") Long id) {
        return "{\"message\": \"User " + id + " deleted\"}";
    }

    @PatchMapping("/api/users/{id}")
    public String patchUser(@PathVariable("id") Long id, @RequestBody String updates) {
        return "{\"message\": \"User " + id + " partially updated: " + updates + "\"}";
    }
}
```

### **2. ê¸°ì¡´ HandlerMapping í™•ì¥ (ìƒˆë¡œìš´ ì–´ë…¸í…Œì´ì…˜ ì§€ì›)**

**ğŸ”„ ê¸°ì¡´ êµ¬í˜„ ë¶„ì„:**

- í˜„ì¬ `HandlerMapping.registerController()`ì—ì„œ `@Controller` + `@RequestMapping` ì¡°í•©ë§Œ ì²˜ë¦¬
- `mappings` Mapì— `"HTTPë©”ì†Œë“œ:URL"` í˜•íƒœë¡œ ì €ì¥
- ê¸°ì¡´ ë¡œì§ì„ ê±´ë“œë¦¬ì§€ ì•Šê³  ìƒˆë¡œìš´ ì–´ë…¸í…Œì´ì…˜ ì§€ì› ì¶”ê°€

**ğŸ¯ í™•ì¥ ì „ëµ:**

```java
// ê¸°ì¡´ HandlerMapping.javaì˜ registerController() ë©”ì†Œë“œ í™•ì¥
public void registerController(Object controller) {
    Class<?> clazz = controller.getClass();

    // 1) ê¸°ì¡´ @Controller ì²˜ë¦¬ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
    if (clazz.isAnnotationPresent(Controller.class)){
        registerRequestMappingMethods(controller, clazz);
    }

    // 2) ìƒˆë¡œìš´ @RestController ì²˜ë¦¬ (ì‹ ê·œ ì¶”ê°€)
    if (clazz.isAnnotationPresent(RestController.class)){
        registerRestControllerMethods(controller, clazz);
    }
}

// ê¸°ì¡´ @RequestMapping ì²˜ë¦¬ ë¡œì§ (ë³€ê²½ ì—†ìŒ)
private void registerRequestMappingMethods(Object controller, Class<?> clazz) {
    Method[] methods = clazz.getDeclaredMethods();
    for (Method method : methods) {
        if (method.isAnnotationPresent(RequestMapping.class)){
            RequestMapping mapping = method.getAnnotation(RequestMapping.class);
            String url = mapping.value();
            RequestMethod httpMethod = mapping.method();

            String mappingKey = httpMethod.name() + ":" + url;
            HandlerMethod handlerMethod = new HandlerMethod(controller, method);
            mappings.put(mappingKey, handlerMethod);

            System.out.println("âœ… @RequestMapping ë“±ë¡: " + url + " -> " + handlerMethod);
        }
    }
}

// ìƒˆë¡œìš´ @GetMapping, @PostMapping ì²˜ë¦¬ ë¡œì§
private void registerRestControllerMethods(Object controller, Class<?> clazz) {
    Method[] methods = clazz.getDeclaredMethods();
    for (Method method : methods) {
        String mappingKey = null;
        String url = null;

        // @GetMapping ì²˜ë¦¬
        if (method.isAnnotationPresent(GetMapping.class)) {
            GetMapping mapping = method.getAnnotation(GetMapping.class);
            url = mapping.value();
            mappingKey = "GET:" + url;
        }
        // @PostMapping ì²˜ë¦¬
        else if (method.isAnnotationPresent(PostMapping.class)) {
            PostMapping mapping = method.getAnnotation(PostMapping.class);
            url = mapping.value();
            mappingKey = "POST:" + url;
        }
        // @PutMapping ì²˜ë¦¬
        else if (method.isAnnotationPresent(PutMapping.class)) {
            PutMapping mapping = method.getAnnotation(PutMapping.class);
            url = mapping.value();
            mappingKey = "PUT:" + url;
        }
        // @DeleteMapping ì²˜ë¦¬
        else if (method.isAnnotationPresent(DeleteMapping.class)) {
            DeleteMapping mapping = method.getAnnotation(DeleteMapping.class);
            url = mapping.value();
            mappingKey = "DELETE:" + url;
        }
        // @PatchMapping ì²˜ë¦¬
        else if (method.isAnnotationPresent(PatchMapping.class)) {
            PatchMapping mapping = method.getAnnotation(PatchMapping.class);
            url = mapping.value();
            mappingKey = "PATCH:" + url;
        }

        if (mappingKey != null) {
            HandlerMethod handlerMethod = new HandlerMethod(controller, method);
            mappings.put(mappingKey, handlerMethod);
            System.out.println("âœ… REST API ë§¤í•‘ ë“±ë¡: " + url + " -> " + handlerMethod);
        }
    }
}
```

**ğŸ“‹ WebApplicationContext í™•ì¥:**

```java
// WebApplicationContextì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ ìŠ¤ìº” ì‹œ @RestControllerë„ ì¸ì‹
public void scanAndRegisterControllers() {
    List<Object> allControllers = new ArrayList<>();

    // ê¸°ì¡´ @Controller ìŠ¤ìº”
    allControllers.addAll(componentScanner.findAnnotatedClasses(Controller.class));

    // ìƒˆë¡œìš´ @RestController ìŠ¤ìº” (ì¶”ê°€)
    allControllers.addAll(componentScanner.findAnnotatedClasses(RestController.class));

    handlerMapping.scanControllers(allControllers);
}
```

---

## ğŸ”— ê¸°ì¡´ êµ¬í˜„ê³¼ì˜ ì—°ê²°ì 

### **1. ê¸°ì¡´ ì•„í‚¤í…ì²˜ í™œìš©**

- **DispatcherServlet**: ê¸°ë³¸ ìš”ì²­ ì²˜ë¦¬ íë¦„ ìœ ì§€
- **HandlerMapping**: ê¸°ì¡´ `mappings` Map êµ¬ì¡° ê·¸ëŒ€ë¡œ í™œìš©
- **HandlerMethod**: ê¸°ì¡´ í´ë˜ìŠ¤ ì¬ì‚¬ìš©
- **WebApplicationContext**: ì»¨íŠ¸ë¡¤ëŸ¬ ìŠ¤ìº” ë¡œì§ í™•ì¥

### **2. í˜¸í™˜ì„± ë³´ì¥**

- **ê¸°ì¡´ UserController**: `@Controller` + `@RequestMapping` ê·¸ëŒ€ë¡œ ë™ì‘
- **ìƒˆë¡œìš´ ApiController**: `@RestController` + `@GetMapping` ì¶”ê°€ ì§€ì›
- **ë™ì‹œ ì‚¬ìš© ê°€ëŠ¥**: ê°™ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë‘ ë°©ì‹ ëª¨ë‘ ì‚¬ìš©

### **3. í™•ì¥ í¬ì¸íŠ¸**

```java
// ê¸°ì¡´: src/main/java/com/melt/web/mapping/HandlerMapping.java
public void registerController(Object controller) {
    // ê¸°ì¡´ ë¡œì§ + ìƒˆë¡œìš´ ë¡œì§ ì¶”ê°€
}

// ê¸°ì¡´: src/main/java/com/melt/web/context/WebApplicationContext.java
public void refresh() {
    // ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” + @RestController ìŠ¤ìº” ì¶”ê°€
}
```

---

## ğŸ¯ ì´ë²ˆ ì£¼ ìµœì†Œ ë‹¬ì„± ëª©í‘œ

### **âœ… ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒ:**

1. **ë¸Œë¼ìš°ì €ì—ì„œ `/api/users` GET ìš”ì²­ ì‹œ JSON ì‘ë‹µ ë°›ê¸°**
2. **`@RestController`, `@GetMapping` ì–´ë…¸í…Œì´ì…˜ ë™ì‘ í™•ì¸**
3. **`@Loggable` ì–´ë…¸í…Œì´ì…˜ ë¶™ì€ ë©”ì†Œë“œ ì‹¤í–‰ ì‹œ ì½˜ì†”ì— ë¡œê·¸ ì¶œë ¥ í™•ì¸**
4. **ê¸°ì¡´ `/users/{id}` ì—”ë“œí¬ì¸íŠ¸ê°€ ì—¬ì „íˆ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸** â­

### **ğŸ”„ í˜¸í™˜ì„± ê²€ì¦:**

- ê¸°ì¡´ `UserController` (`@Controller` + `@RequestMapping`) ì •ìƒ ë™ì‘
- ìƒˆë¡œìš´ `ApiController` (`@RestController` + `@GetMapping`) ì •ìƒ ë™ì‘
- ë‘ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë™ì‹œì— ë¬¸ì œì—†ì´ ì‘ë™

### **â­ ë„ì „ ê³¼ì œ (ì‹œê°„ ì—¬ìœ  ìˆìœ¼ë©´):**

- POST ìš”ì²­ìœ¼ë¡œ ë°ì´í„° ìƒì„± API ë§Œë“¤ì–´ë³´ê¸°
- ë‹¤ì–‘í•œ REST ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€í•´ë³´ê¸°

---

## ğŸ”‘ í•™ìŠµ í‚¤ì›Œë“œ

- **REST API** â­â­â­
- **AOP (Aspect-Oriented Programming)** â­â­â­
- **Dynamic Proxy & InvocationHandler** â­â­â­
- **@RestController**, **@GetMapping**, **@PostMapping**
- **Cross-cutting Concerns**, **Proxy Pattern**
- **JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”**
- `Proxy.newProxyInstance()`, `Method.invoke()`
