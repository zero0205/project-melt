# 7ì£¼ì°¨: REST API í™•ì¥ + AOP ê¸°ì´ˆ

**ğŸ¯ êµ¬í˜„ ëª©í‘œ:**

- **RESTful API ì–´ë…¸í…Œì´ì…˜ í™•ì¥** (@RestController, @GetMapping, @PostMapping)
- **AOP (Aspect-Oriented Programming)** ê¸°ì´ˆ - íš¡ë‹¨ ê´€ì‹¬ì‚¬ ë¶„ë¦¬

**ğŸ“‹ í˜„ì¬ ìƒí™©:**

- âœ… ê¸°ë³¸ MVC êµ¬ì¡° ì™„ì„± (@Controller, @RequestMapping)
- âœ… íŒŒë¼ë¯¸í„° ë°”ì¸ë”© (@RequestParam, @PathVariable, @RequestBody)
- âœ… HTTP ë©”ì†Œë“œë³„ ì²˜ë¦¬ (GET, POST, PUT, DELETE)
- âœ… JSON ì‘ë‹µ ì²˜ë¦¬

---

## ğŸ“š ë³‘í–‰ í•™ìŠµ (20ë¶„)

### **í•µì‹¬ í•™ìŠµ ë‚´ìš©:**

- **REST API ì›ì¹™** - HTTP ë©”ì†Œë“œ í™œìš©
- **Dynamic Proxy & InvocationHandler** - AOP êµ¬í˜„ì˜ í•µì‹¬ â­â­â­
- **Proxy Pattern** - AOPì˜ ê¸°ë°˜ ë””ìì¸ íŒ¨í„´
- **JSON ë¼ì´ë¸ŒëŸ¬ë¦¬** (Jackson ë˜ëŠ” Gson) ê¸°ì´ˆ

### **ì¶”ê°€ ìë°” ê°œë…:**

```java
// Dynamic Proxy - AOPì˜ í•µì‹¬ ê¸°ìˆ 
import java.lang.reflect.Proxy;
import java.lang.reflect.InvocationHandler;

public class ProxyFactory {
    public static Object createProxy(Object target) {
        return Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            target.getClass().getInterfaces(),
            (proxy, method, args) -> {
                // ë©”ì†Œë“œ ì‹¤í–‰ ì „ ì²˜ë¦¬ (AOP)
                System.out.println("Before: " + method.getName());
                Object result = method.invoke(target, args);
                System.out.println("After: " + method.getName());
                return result;
            }
        );
    }
}
```

---

## ğŸ§  í•µì‹¬ ê°œë… ì´í•´

- **REST API**: Representational State Transfer, HTTPë¥¼ ì˜ í™œìš©í•œ API ì„¤ê³„ ì›ì¹™
- **AOP (Aspect-Oriented Programming)**: íš¡ë‹¨ ê´€ì‹¬ì‚¬(ë¡œê¹…, ë³´ì•ˆ, íŠ¸ëœì­ì…˜)ë¥¼ ë¶„ë¦¬í•˜ëŠ” í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„
- **Cross-cutting Concerns**: ì—¬ëŸ¬ ëª¨ë“ˆì— ê±¸ì³ ë‚˜íƒ€ë‚˜ëŠ” ê³µí†µ ê¸°ëŠ¥ë“¤
- **Dynamic Proxy**: ëŸ°íƒ€ì„ì— í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ AOP êµ¬í˜„
- **InvocationHandler**: í”„ë¡ì‹œ ê°ì²´ì˜ ë©”ì†Œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ëŠ” í•¸ë“¤ëŸ¬

---

## ğŸ’» êµ¬í˜„ ë‚´ìš© (40ë¶„)

### **1. REST API ì–´ë…¸í…Œì´ì…˜ í™•ì¥**

```java
// 1) @RestController ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface RestController {}

// 2) HTTP ë©”ì†Œë“œë³„ ë‹¨ì¶• ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface GetMapping {
    String value();
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface PostMapping {
    String value();
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface PutMapping {
    String value();
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DeleteMapping {
    String value();
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface PatchMapping {
    String value();
}

// 3) ê¸°ì¡´ UserControllerë¥¼ REST API ìŠ¤íƒ€ì¼ë¡œ í™•ì¥
@RestController  // ìƒˆë¡œìš´ REST ì»¨íŠ¸ë¡¤ëŸ¬
public class ApiController {

    @Autowired
    private UserService userService;

    @GetMapping("/api/users")  // ê¸°ì¡´ @RequestMapping ëŒ€ì‹  ë‹¨ì¶•í˜•
    public String getUsers() {
        return "{\"users\": \"API response\"}";
    }

    @PostMapping("/api/users")
    public String createUser(@RequestBody String user) {
        return "{\"message\": \"User created: " + user + "\"}";
    }

    @PutMapping("/api/users/{id}")
    public String updateUser(@PathVariable("id") Long id, @RequestBody String user) {
        return "{\"message\": \"User " + id + " updated: " + user + "\"}";
    }

    @DeleteMapping("/api/users/{id}")
    public String deleteUser(@PathVariable("id") Long id) {
        return "{\"message\": \"User " + id + " deleted\"}";
    }

    @PatchMapping("/api/users/{id}")
    public String patchUser(@PathVariable("id") Long id, @RequestBody String updates) {
        return "{\"message\": \"User " + id + " partially updated: " + updates + "\"}";
    }
}
```

### **2. AOP ê¸°ì´ˆ êµ¬í˜„ - Dynamic Proxy í™œìš©**

```java
// AOP ê¸°ì´ˆ - ë¡œê¹… ì–´ë…¸í…Œì´ì…˜
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Loggable {}

// Dynamic Proxyë¥¼ ìœ„í•œ InvocationHandler êµ¬í˜„
public class LoggingInvocationHandler implements InvocationHandler {
    private final Object target;

    public LoggingInvocationHandler(Object target) {
        this.target = target;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // AOP ë¡œì§ì´ ë“¤ì–´ê°€ëŠ” í•µì‹¬ ë¶€ë¶„
        if (method.isAnnotationPresent(Loggable.class)) {
            long start = System.currentTimeMillis();
            System.out.println("=== ë©”ì†Œë“œ ì‹¤í–‰ ì‹œì‘: " + method.getName() + " ===");

            Object result = method.invoke(target, args);  // ì‹¤ì œ ë©”ì†Œë“œ ì‹¤í–‰

            long end = System.currentTimeMillis();
            System.out.println("=== ë©”ì†Œë“œ ì‹¤í–‰ ì™„ë£Œ: " + method.getName() + " (" + (end - start) + "ms) ===");
            return result;
        }
        return method.invoke(target, args);
    }
}

// AOP í”„ë¡ì‹œ íŒ©í† ë¦¬
public class AopProxyFactory {
    public static <T> T createProxy(T target, Class<T> interfaceType) {
        return (T) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            new Class[]{interfaceType},
            new LoggingInvocationHandler(target)
        );
    }
}
```

### **3. ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ (AOP ì ìš©ìš©)**

```java
// ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ (AOP ì ìš©ì„ ìœ„í•´ ì¸í„°í˜ì´ìŠ¤ í•„ìš”)
public interface UserService {
    List<User> getAllUsers();
    void saveUser(User user);
}

@Service
public class UserServiceImpl implements UserService {

    @Loggable  // ì´ ë©”ì†Œë“œì— AOP ì ìš©
    public List<User> getAllUsers() {
        // ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
        return Arrays.asList(new User("John"), new User("Jane"));
    }

    @Loggable
    public void saveUser(User user) {
        System.out.println("Saving user: " + user.getName());
    }
}
```

### **4. IoC ì»¨í…Œì´ë„ˆì— AOP ê¸°ëŠ¥ í†µí•©**

```java
public class IoContainer {
    private Map<String, Object> beans = new HashMap<>();

    public void registerBean(String name, Object bean) {
        // ì¸í„°í˜ì´ìŠ¤ê°€ ìˆìœ¼ë©´ AOP í”„ë¡ì‹œ ìƒì„±
        Class<?>[] interfaces = bean.getClass().getInterfaces();
        if (interfaces.length > 0) {
            Object proxy = AopProxyFactory.createProxy(bean, interfaces[0]);
            beans.put(name, proxy);  // í”„ë¡ì‹œë¥¼ ì»¨í…Œì´ë„ˆì— ë“±ë¡
            System.out.println("AOP í”„ë¡ì‹œê°€ ì ìš©ëœ " + name + " ë¹ˆì„ ë“±ë¡í–ˆìŠµë‹ˆë‹¤.");
        } else {
            beans.put(name, bean);  // ì›ë³¸ ê°ì²´ ë“±ë¡
            System.out.println("ì¼ë°˜ " + name + " ë¹ˆì„ ë“±ë¡í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    public <T> T getBean(String name, Class<T> type) {
        return type.cast(beans.get(name));
    }
}
```

### **5. ê¸°ì¡´ HandlerMapping í™•ì¥ (ìƒˆë¡œìš´ ì–´ë…¸í…Œì´ì…˜ ì§€ì›)**

**ğŸ”„ ê¸°ì¡´ êµ¬í˜„ ë¶„ì„:**

- í˜„ì¬ `HandlerMapping.registerController()`ì—ì„œ `@Controller` + `@RequestMapping` ì¡°í•©ë§Œ ì²˜ë¦¬
- `mappings` Mapì— `"HTTPë©”ì†Œë“œ:URL"` í˜•íƒœë¡œ ì €ì¥
- ê¸°ì¡´ ë¡œì§ì„ ê±´ë“œë¦¬ì§€ ì•Šê³  ìƒˆë¡œìš´ ì–´ë…¸í…Œì´ì…˜ ì§€ì› ì¶”ê°€

**ğŸ¯ í™•ì¥ ì „ëµ:**

```java
// ê¸°ì¡´ HandlerMapping.javaì˜ registerController() ë©”ì†Œë“œ í™•ì¥
public void registerController(Object controller) {
    Class<?> clazz = controller.getClass();

    // 1) ê¸°ì¡´ @Controller ì²˜ë¦¬ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
    if (clazz.isAnnotationPresent(Controller.class)){
        registerRequestMappingMethods(controller, clazz);
    }

    // 2) ìƒˆë¡œìš´ @RestController ì²˜ë¦¬ (ì‹ ê·œ ì¶”ê°€)
    if (clazz.isAnnotationPresent(RestController.class)){
        registerRestControllerMethods(controller, clazz);
    }
}

// ê¸°ì¡´ @RequestMapping ì²˜ë¦¬ ë¡œì§ (ë³€ê²½ ì—†ìŒ)
private void registerRequestMappingMethods(Object controller, Class<?> clazz) {
    Method[] methods = clazz.getDeclaredMethods();
    for (Method method : methods) {
        if (method.isAnnotationPresent(RequestMapping.class)){
            RequestMapping mapping = method.getAnnotation(RequestMapping.class);
            String url = mapping.value();
            RequestMethod httpMethod = mapping.method();

            String mappingKey = httpMethod.name() + ":" + url;
            HandlerMethod handlerMethod = new HandlerMethod(controller, method);
            mappings.put(mappingKey, handlerMethod);

            System.out.println("âœ… @RequestMapping ë“±ë¡: " + url + " -> " + handlerMethod);
        }
    }
}

// ìƒˆë¡œìš´ @GetMapping, @PostMapping ì²˜ë¦¬ ë¡œì§
private void registerRestControllerMethods(Object controller, Class<?> clazz) {
    Method[] methods = clazz.getDeclaredMethods();
    for (Method method : methods) {
        String mappingKey = null;
        String url = null;

        // @GetMapping ì²˜ë¦¬
        if (method.isAnnotationPresent(GetMapping.class)) {
            GetMapping mapping = method.getAnnotation(GetMapping.class);
            url = mapping.value();
            mappingKey = "GET:" + url;
        }
        // @PostMapping ì²˜ë¦¬
        else if (method.isAnnotationPresent(PostMapping.class)) {
            PostMapping mapping = method.getAnnotation(PostMapping.class);
            url = mapping.value();
            mappingKey = "POST:" + url;
        }

        if (mappingKey != null) {
            HandlerMethod handlerMethod = new HandlerMethod(controller, method);
            mappings.put(mappingKey, handlerMethod);
            System.out.println("âœ… REST API ë§¤í•‘ ë“±ë¡: " + url + " -> " + handlerMethod);
        }
    }
}
```

**ğŸ“‹ WebApplicationContext í™•ì¥:**

```java
// WebApplicationContextì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ ìŠ¤ìº” ì‹œ @RestControllerë„ ì¸ì‹
public void scanAndRegisterControllers() {
    List<Object> allControllers = new ArrayList<>();

    // ê¸°ì¡´ @Controller ìŠ¤ìº”
    allControllers.addAll(componentScanner.findAnnotatedClasses(Controller.class));

    // ìƒˆë¡œìš´ @RestController ìŠ¤ìº” (ì¶”ê°€)
    allControllers.addAll(componentScanner.findAnnotatedClasses(RestController.class));

    handlerMapping.scanControllers(allControllers);
}
```

---

## ğŸ”— ê¸°ì¡´ êµ¬í˜„ê³¼ì˜ ì—°ê²°ì 

### **1. ê¸°ì¡´ ì•„í‚¤í…ì²˜ í™œìš©**

- **DispatcherServlet**: ê¸°ë³¸ ìš”ì²­ ì²˜ë¦¬ íë¦„ ìœ ì§€
- **HandlerMapping**: ê¸°ì¡´ `mappings` Map êµ¬ì¡° ê·¸ëŒ€ë¡œ í™œìš©
- **HandlerMethod**: ê¸°ì¡´ í´ë˜ìŠ¤ ì¬ì‚¬ìš©
- **WebApplicationContext**: ì»¨íŠ¸ë¡¤ëŸ¬ ìŠ¤ìº” ë¡œì§ í™•ì¥

### **2. í˜¸í™˜ì„± ë³´ì¥**

- **ê¸°ì¡´ UserController**: `@Controller` + `@RequestMapping` ê·¸ëŒ€ë¡œ ë™ì‘
- **ìƒˆë¡œìš´ ApiController**: `@RestController` + `@GetMapping` ì¶”ê°€ ì§€ì›
- **ë™ì‹œ ì‚¬ìš© ê°€ëŠ¥**: ê°™ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë‘ ë°©ì‹ ëª¨ë‘ ì‚¬ìš©

### **3. í™•ì¥ í¬ì¸íŠ¸**

```java
// ê¸°ì¡´: src/main/java/com/melt/web/mapping/HandlerMapping.java
public void registerController(Object controller) {
    // ê¸°ì¡´ ë¡œì§ + ìƒˆë¡œìš´ ë¡œì§ ì¶”ê°€
}

// ê¸°ì¡´: src/main/java/com/melt/web/context/WebApplicationContext.java
public void refresh() {
    // ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” + @RestController ìŠ¤ìº” ì¶”ê°€
}
```

---

## ğŸ“ êµ¬í˜„ ìˆœì„œ (7ì¼ ê³„íš)

### **Day 1-2**: Dynamic Proxy & InvocationHandler í•™ìŠµ ë° ê¸°ì´ˆ êµ¬í˜„

- `Proxy.newProxyInstance()` ì‚¬ìš©ë²• ìµíˆê¸°
- `InvocationHandler` êµ¬í˜„í•´ë³´ê¸°
- ê°„ë‹¨í•œ ë¡œê¹… í”„ë¡ì‹œ ë§Œë“¤ì–´ë³´ê¸°

### **Day 3-4**: REST API ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€

- `@RestController`, `@GetMapping`, `@PostMapping` ì–´ë…¸í…Œì´ì…˜ ì •ì˜
- ê¸°ì¡´ `@RequestMapping`ê³¼ ë³‘í–‰ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ êµ¬í˜„

### **Day 5**: ê¸°ì¡´ HandlerMapping í™•ì¥

- **ê¸°ì¡´ `HandlerMapping.registerController()` ë©”ì†Œë“œ í™•ì¥**
  - `registerRequestMappingMethods()` ë©”ì†Œë“œë¡œ ê¸°ì¡´ ë¡œì§ ë¶„ë¦¬
  - `registerRestControllerMethods()` ë©”ì†Œë“œ ì¶”ê°€
- **WebApplicationContextì—ì„œ `@RestController` ìŠ¤ìº” ì¶”ê°€**
- **ê¸°ì¡´ `@Controller` + `@RequestMapping` ê³¼ í˜¸í™˜ì„± ìœ ì§€**

### **Day 6**: AOPì™€ IoC ì»¨í…Œì´ë„ˆ í†µí•©

- ì»¨í…Œì´ë„ˆì—ì„œ ë¹ˆ ë“±ë¡ ì‹œ ìë™ìœ¼ë¡œ AOP í”„ë¡ì‹œ ìƒì„±
- `@Loggable` ì–´ë…¸í…Œì´ì…˜ ì ìš©ëœ ë©”ì†Œë“œì— ë¡œê¹… ê¸°ëŠ¥ ë™ì‘

### **Day 7**: í†µí•© í…ŒìŠ¤íŠ¸

- **ApiController ìƒì„± ë° ì „ì²´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸**
  - `@RestController` + `@GetMapping` ì¡°í•© í…ŒìŠ¤íŠ¸
  - ê¸°ì¡´ `UserController`ì™€ ìƒˆë¡œìš´ `ApiController` ë™ì‹œ ë™ì‘ í™•ì¸
- **ë¸Œë¼ìš°ì €ì—ì„œ `/api/users` ìš”ì²­ ì‹œ JSON ì‘ë‹µ í™•ì¸**
- **AOP ë¡œê¹…ì´ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸**
- **ê¸°ì¡´ `/users/{id}` ì—”ë“œí¬ì¸íŠ¸ì™€ì˜ í˜¸í™˜ì„± í™•ì¸**

---

## ğŸ¯ ì´ë²ˆ ì£¼ ìµœì†Œ ë‹¬ì„± ëª©í‘œ

### **âœ… ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒ:**

1. **ë¸Œë¼ìš°ì €ì—ì„œ `/api/users` GET ìš”ì²­ ì‹œ JSON ì‘ë‹µ ë°›ê¸°**
2. **`@RestController`, `@GetMapping` ì–´ë…¸í…Œì´ì…˜ ë™ì‘ í™•ì¸**
3. **`@Loggable` ì–´ë…¸í…Œì´ì…˜ ë¶™ì€ ë©”ì†Œë“œ ì‹¤í–‰ ì‹œ ì½˜ì†”ì— ë¡œê·¸ ì¶œë ¥ í™•ì¸**
4. **ê¸°ì¡´ `/users/{id}` ì—”ë“œí¬ì¸íŠ¸ê°€ ì—¬ì „íˆ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸** â­

### **ğŸ”„ í˜¸í™˜ì„± ê²€ì¦:**

- ê¸°ì¡´ `UserController` (`@Controller` + `@RequestMapping`) ì •ìƒ ë™ì‘
- ìƒˆë¡œìš´ `ApiController` (`@RestController` + `@GetMapping`) ì •ìƒ ë™ì‘
- ë‘ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë™ì‹œì— ë¬¸ì œì—†ì´ ì‘ë™

### **â­ ë„ì „ ê³¼ì œ (ì‹œê°„ ì—¬ìœ  ìˆìœ¼ë©´):**

- POST ìš”ì²­ìœ¼ë¡œ ë°ì´í„° ìƒì„± API ë§Œë“¤ì–´ë³´ê¸°
- ë‹¤ì–‘í•œ REST ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€í•´ë³´ê¸°
- AOPì— ë‹¤ë¥¸ ê¸°ëŠ¥(ì‹¤í–‰ ì‹œê°„ ì¸¡ì • ì™¸) ì¶”ê°€í•´ë³´ê¸°

---

## ğŸ”‘ í•™ìŠµ í‚¤ì›Œë“œ

- **REST API** â­â­â­
- **AOP (Aspect-Oriented Programming)** â­â­â­
- **Dynamic Proxy & InvocationHandler** â­â­â­
- **@RestController**, **@GetMapping**, **@PostMapping**
- **Cross-cutting Concerns**, **Proxy Pattern**
- **JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”**
- `Proxy.newProxyInstance()`, `Method.invoke()`

---

## ğŸ’¡ ì‹¤ìš©ì  íŒ

### **ì‹œê°„ ì ˆì•½ì„ ìœ„í•œ ì ‘ê·¼:**

- **ë³µì¡í•œ AOP êµ¬í˜„ì€ ìŠ¤í‚µ**: CGLIB, AspectJ ë¬¸ë²• ì œì™¸
- **í•µì‹¬ë§Œ êµ¬í˜„**: ê°„ë‹¨í•œ Dynamic Proxyë§Œ
- **Method-level Annotation ê¸°ë°˜**ìœ¼ë¡œë§Œ AOP ì ìš©
- **ì™„ë²½ë³´ë‹¤ëŠ” ë™ì‘**ì— ì´ˆì 

### **í”„ë¡ íŠ¸ì—”ë“œ ê²½í—˜ í™œìš©:**

- **API í˜¸ì¶œ ë°©ì‹**ì€ ì´ë¯¸ ì•„ì‹¤ í…Œë‹ˆ, ì„œë²„ ìª½ êµ¬í˜„ì— ì§‘ì¤‘
- **JSON êµ¬ì¡°**ë„ ìµìˆ™í•˜ì‹¤ ê²ƒ ê°™ì•„ìš”
- **HTTP ë©”ì†Œë“œ** (GET, POST ë“±) ê°œë…ë„ ì•„ì‹¤ í…Œë‹ˆ êµ¬í˜„ë§Œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤!

**Dynamic Proxy**ë§Œ ì œëŒ€ë¡œ ì´í•´í•˜ì‹œë©´ ë‚˜ë¨¸ì§€ëŠ” ì‘ìš©ì´ë‹ˆê¹Œ, ì´ê²ƒë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”! ğŸš€
